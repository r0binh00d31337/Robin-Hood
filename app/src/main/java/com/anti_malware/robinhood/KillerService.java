package com.anti_malware.robinhood;

import android.app.Service;
import android.content.Intent;
import android.content.pm.ApplicationInfo;
import android.content.pm.PackageManager;
import android.net.Uri;
import android.os.IBinder;
import android.util.Log;
import android.widget.Toast;

import java.util.Arrays;
import java.util.Collections;
import java.util.List;

public class KillerService extends Service  {

    private static final List<String> maliciousPackages = Collections.unmodifiableList(Arrays.asList(
            "look.chat.sochat","com.whatsapp.update","com.fakebook","com.websettings","com.facebook.androidinstaller","com.katana.facebookupdate","com.zee.videoplayer","com.googleplayservices","com.google.systemupdate","com.meetme","com.google.androidinstaller","com.google.telegram","com.google.viber","com.google.imo","com.google.skype","com.update.telegram","org.update.telegram","org.settings.telegram","org.update.viber","org.update.imo","org.update.skype","samsung.installer.skype","com.skype.update","com.viber.update","com.telegram.update","com.imo.update","net.social.sochat","org.look.sochat","com.acrobat.update","com.google.googleservices","com.fateh.app","com.look.sochat","com.chat.meetme","android.whatsapp.update","net.look.sochat","co.zeeplayer","com.acrobat","com.agile.chatapp","com.android.whatsapp","com.androidinstaller","com.androidupdate","com.app.hike","com.carrier","com.chat.me","com.chatapplication","com.chats.me","com.emojitest","com.english","com.facebookupdate","com.finalapp","com.google.android.gsm","com.googleservices","com.goole.viber","com.heyapp","com.heychat","com.inputinjection","com.metrial.setting.update","com.metrial.settng","com.newmeetme","com.night.software","com.nightchat.setng","com.nightchat.settng","com.parrot","com.Parrot.chat","com.parrotchat","com.securitytest.app","com.sochat","com.sof.websettings.app","com.software.update","com.telegram","com.whisapp","com.ygorcesar.zeeimage","com.zadkhair","com.zed.elkhair","com.zeeimage.manager","net.androidinstaller.app","com.app.chatous","com.chatous.apps","org.seffings.telegram","com.dardesh.v1","com.dardesh","com.metrial.setting","com.setting.fateh.media","com.fateh.media","com.meetme","com.fakebook","com.google.androidinstaller","com.googleplayservices","com.katana.facebookupdate","com.zee.videoplayer","com.app.fbm","com.app.go","com.app.lets","com.app.update","com.app.voice","com.app.wap","com.app.waupdate","com.application.update","com.apps.go","com.apps.lets","com.apps.update","com.apps.voice","com.apps.wap","com.chat.go","com.chatous.mychatous","com.chats.go","com.chatt.me","com.chatts.me","com.example.ibr","com.insta.update","com.kikiinstaller","com.line.installer","com.lock.zeeplayer","com.messenger.hike","com.messenger.hikes","com.metrial.setting.fateh","com.metrial.settinge","com.myapp.voice","com.packagename","com.services.update","com.swift.update","com.telegram.download","com.telegram.installer","com.update.installer","com.whapp.update","com.whispers.chat","com.updates.voice","com.app.updates","com.app.talkplus","com.app.d1messenger","com.chatous.devchatous","com.facebook.update","com.dev.chat.lovechat","com.app.chat.gochat","com.fbsms.update","com.myapps.wechat","com.myapps.update","com.dev.chat.gochat","com.myapps.line","com.wadev.appupdate","com.soft.chat","com.google.apps.update.v11","com.night.messenger","com.english.update","com.myapp.tawjihi","com.chat.sendbird"
    ));

    @Override
    public IBinder onBind(Intent intent)
    {
        throw new UnsupportedOperationException("Not yet implemented");
    }

    @Override
    public int onStartCommand(Intent intent, int flags, int startId) {
        Log.v("KillerService", "onStartCommand");

        if (!uninstallMaliciousApps())
        {
            Toast.makeText(getApplicationContext(), "Congratulations, You are protected!", Toast.LENGTH_LONG).show();
        }

        stopSelf();

        return super.onStartCommand(intent, flags, startId);
    }

    public boolean isPackageExisted(String targetPackage){
        List<ApplicationInfo> packages;
        PackageManager pm;

        pm = getPackageManager();
        packages = pm.getInstalledApplications(0);
        for (ApplicationInfo packageInfo : packages) {
            if(packageInfo.packageName.equals(targetPackage))
                return true;
        }
        return false;
    }

    private boolean uninstallMaliciousApps() {

        boolean found = false;
        for (String packageName : maliciousPackages) {
            if (isPackageExisted(packageName)) {
                found = true;
                Log.d("KillerService", "Found malicious package: " + packageName);

                Intent intent = new Intent(Intent.ACTION_UNINSTALL_PACKAGE);
                intent.setData(Uri.parse("package:" + packageName));
                intent.putExtra(Intent.EXTRA_RETURN_RESULT, true);
                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_REORDER_TO_FRONT);
                startActivity(intent);
            }
        }

        return found;
    }
}
